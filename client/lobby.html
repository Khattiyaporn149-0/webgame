<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lobby</title>
  <style>
    body {
      margin: 0;
      background: #0b1324;
      color: #E6E6FA;
      font-family: 'Segoe UI', system-ui, sans-serif;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* üîô ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö */
    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: linear-gradient(135deg, #54f4a8, #25c07d);
      color: #0b1324;
      border: none;
      padding: 10px 18px;
      border-radius: 50px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 10px #0007;
      transition: all 0.2s ease;
    }
    .back-btn:hover { transform: translateY(-2px); }

    /* üßç ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏´‡∏•‡∏±‡∏Å */
    .char-section {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      flex-direction: column;
    }

    .char-box {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 18px;
    }

    .char-btn {
      font-size: 36px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .char-btn:hover { transform: scale(1.2); }

    .char-img {
      width: 128px;
      height: 128px;
      object-fit: contain;
      image-rendering: pixelated;
    }

    /* üîò ‡πÄ‡∏á‡∏≤‡∏Å‡∏•‡∏°‡πÜ ‡πÉ‡∏ï‡πâ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ */
    .shadow {
      width: 90px;
      height: 20px;
      border-radius: 50%;
      background: radial-gradient(ellipse at center, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 70%);
      margin-top: -10px;
    }

    /* üü© ‡∏õ‡∏∏‡πà‡∏° Ready */
    .ready-btn {
      background: linear-gradient(135deg, #2fe093, #25c07d);
      border: none;
      padding: 12px 28px;
      border-radius: 12px;
      color: #0b1324;
      font-weight: 800;
      font-size: 18px;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 8px 20px #0007;
      transition: transform 0.1s;
    }
    .ready-btn:hover { transform: translateY(-2px); }

    /* üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô */
    .player-list {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 220px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 14px;
      padding: 12px;
      box-shadow: 0 8px 30px #0008;
    }
    .player-list h3 {
      margin: 0 0 8px;
      font-size: 16px;
      color: #8be9fd;
      text-align: center;
    }
    .player-list ul {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 200px;
      overflow-y: auto;
    }
    .player-list li {
      padding: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      font-size: 14px;
      text-align: center;
    }

    /* üí¨ ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ä‡∏ó */
    .chat-box {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 280px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 14px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 8px 30px #0008;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      max-height: 180px;
      font-size: 14px;
    }
    .chat-input {
      margin-top: 8px;
      display: flex;
      gap: 6px;
    }
    .chat-input input {
      flex: 1;
      padding: 6px 8px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.15);
      color: white;
      outline: none;
    }
    .chat-input button {
      padding: 6px 10px;
      background: #54f4a8;
      border: none;
      border-radius: 8px;
      color: #0b1324;
      cursor: pointer;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <button class="back-btn" id="btnBack">‚¨Ö Home</button>

  <!-- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô -->
  <div class="player-list">
    <h3>üë• Players</h3>
    <ul id="playerList">
      <li>YOU</li>
      <li>Guest_1</li>
      <li>Guest_2</li>
    </ul>
  </div>

  <!-- ‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ -->
  <div class="char-section">
    <h1>üéÆ Lobby</h1>
    <p>Room: <span id="roomName"></span> | Code: <span id="roomCode"></span></p>

    <div class="char-box">
      <button class="char-btn" id="prevChar">‚¨Ö</button>
      <img id="charImage" class="char-img" src="" alt="Character">
      <button class="char-btn" id="nextChar">‚û°</button>
    </div>
    <div class="shadow"></div>
    <h3 id="charLabel">BROWN</h3>

    <button class="ready-btn" id="readyBtn">READY ‚úÖ</button>
  </div>

  <!-- ‡πÅ‡∏ä‡∏ó -->
  <div class="chat-box">
    <div class="chat-messages" id="chatMessages"></div>
    <div class="chat-input">
      <input type="text" id="chatInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
      <button id="sendBtn">Send</button>
    </div>
  </div>

  <script>
    // ==== ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ ====
    const characters = [
      "mini_brown", "mini_coral", "mini_gray",
      "mini_lavender", "mini_mint", "mini_pink",
      "mini_sky_blue", "mini_yellow"
    ];
    let currentCharIndex = 0;
    let currentAction = "idle_1"; 

    const img = document.getElementById("charImage");
    const label = document.getElementById("charLabel");

    function updateCharacter() {
      const folder = characters[currentCharIndex];
      img.src = `./assets/Characters/${folder}/${currentAction}.png`;
      label.textContent = folder.replace("mini_", "").replace("_", " ").toUpperCase();
    }

    document.getElementById("prevChar").addEventListener("click", () => {
      currentCharIndex = (currentCharIndex - 1 + characters.length) % characters.length;
      updateCharacter();
    });
    document.getElementById("nextChar").addEventListener("click", () => {
      currentCharIndex = (currentCharIndex + 1) % characters.length;
      updateCharacter();
    });

    updateCharacter();

    // ==== ‡∏õ‡∏∏‡πà‡∏° Ready ====
    document.getElementById("readyBtn").addEventListener("click", e => {
      e.target.textContent = "READY ‚úî";
      e.target.style.background = "linear-gradient(135deg,#ffd86b,#ffc34a)";
    });

    // ==== ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö ====
    document.getElementById("btnBack").addEventListener("click", () => {
      window.location.href = "createroom.html";
    });

    // ==== ‡πÅ‡∏ä‡∏ó‡∏à‡∏≥‡∏•‡∏≠‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° socket) ====
    const chatMessages = document.getElementById("chatMessages");
    const chatInput = document.getElementById("chatInput");
    const sendBtn = document.getElementById("sendBtn");

    function addMessage(text, sender = "You") {
      const p = document.createElement("p");
      p.innerHTML = `<b>${sender}:</b> ${text}`;
      chatMessages.appendChild(p);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    sendBtn.addEventListener("click", () => {
      const msg = chatInput.value.trim();
      if (!msg) return;
      addMessage(msg);
      chatInput.value = "";
    });

    const roomCode = localStorage.getItem("currentRoomCode"); // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏ï‡∏≠‡∏ô join

    // ==========================
    // Ready button ‚Üí ‡πÅ‡∏à‡πâ‡∏á server
    // ==========================
    document.getElementById("readyBtn").addEventListener("click", e => {
    const isReady = e.target.classList.toggle("ready");
    e.target.textContent = isReady ? "READY" : "UNREADY";
    e.target.style.background = isReady
        ? "linear-gradient(135deg,#ffd86b,#ffc34a)"
        : "linear-gradient(135deg,#2fe093,#25c07d)";

    socket.emit("playerReady", { room: roomCode, ready: isReady });
    });

    // ==========================
    // ‡∏£‡∏±‡∏ö broadcast ‡∏à‡∏≤‡∏Å server
    // ==========================
    socket.on("updatePlayers", (list) => {
    const ul = document.getElementById("playerList");
    ul.innerHTML = "";
    list.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.name} ${p.ready ? "‚úî" : "‚åõ"}`;
        ul.appendChild(li);
    });
    });
    document.getElementById("roomName").textContent = localStorage.getItem("currentRoomName") || "My Room";
    document.getElementById("roomCode").textContent = roomCode || "XXXX";

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ server
    sendBtn.addEventListener("click", () => {
    const msg = chatInput.value.trim();
    if (!msg) return;
    socket.emit("chatMessage", { room: roomCode, text: msg });
    chatInput.value = "";
    });

    // ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å server
    socket.on("chatMessage", (data) => {
    addMessage(data.text, data.sender);
    });

  </script>
</body>
</html>
